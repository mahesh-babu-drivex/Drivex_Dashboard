{
  "pluginType": "DB",
  "pluginId": "postgres-plugin",
  "unpublishedAction": {
    "name": "procurement",
    "datasource": {
      "name": "Postgres",
      "pluginId": "postgres-plugin",
      "messages": [],
      "isAutoGenerated": false,
      "id": "Postgres",
      "deleted": false,
      "policies": [],
      "userPermissions": []
    },
    "pageId": "Page1",
    "actionConfiguration": {
      "timeoutInMillisecond": 10000,
      "paginationType": "NONE",
      "encodeParamsToggle": true,
      "body": "WITH MTD_CTE AS (\n    SELECT\n        procured_channel,\n        COUNT(*) AS mtd_count\n    FROM\n        cleaned.database\n    WHERE\n        EXTRACT(YEAR FROM payment_date) = EXTRACT(YEAR FROM CURRENT_DATE)\n        AND EXTRACT(MONTH FROM payment_date) = EXTRACT(MONTH FROM CURRENT_DATE)\n        AND procured_channel IS NOT NULL  -- Filter out NULL values\n    GROUP BY\n        procured_channel\n),\nYESTERDAY_CTE AS (\n    SELECT\n        procured_channel,\n        COUNT(*) AS yesterday_count\n    FROM\n        cleaned.database\n    WHERE\n        DATE(payment_date) = CURRENT_DATE - INTERVAL '1 day'\n        AND procured_channel IS NOT NULL  -- Filter out NULL values\n    GROUP BY\n        procured_channel\n)\nSELECT\n    COALESCE(MTD_CTE.procured_channel, YESTERDAY_CTE.procured_channel, 'Total') AS procured_channel,\n    COALESCE(SUM(MTD_CTE.mtd_count), 0) AS mtd_count,\n    COALESCE(SUM(YESTERDAY_CTE.yesterday_count), 0) AS yesterday_count\nFROM\n    MTD_CTE\nFULL OUTER JOIN YESTERDAY_CTE\n    ON MTD_CTE.procured_channel = YESTERDAY_CTE.procured_channel\nWHERE\n    MTD_CTE.procured_channel IS NOT NULL OR YESTERDAY_CTE.procured_channel IS NOT NULL  -- Exclude NULL values\nGROUP BY\n    GROUPING SETS ((MTD_CTE.procured_channel, YESTERDAY_CTE.procured_channel), ());\n",
      "selfReferencingDataPaths": [],
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ]
    },
    "executeOnLoad": true,
    "dynamicBindingPathList": [],
    "isValid": true,
    "invalids": [],
    "messages": [],
    "jsonPathKeys": [],
    "userSetOnLoad": false,
    "confirmBeforeExecute": false,
    "policies": [],
    "userPermissions": [],
    "createdAt": "2023-11-09T07:11:44Z"
  },
  "id": "Page1_procurement",
  "deleted": false,
  "gitSyncId": "654c5d4e80e26167c30e16c9_654c863080e26167c30e1707"
}